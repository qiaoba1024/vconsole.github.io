

<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>VConsole</title>
  </head>
  <body>
    <script src="vconsole.min.js"></script>

	
    <script type="text/javascript">


       let create_wesocket = function(){
        if (!window.WebSocket) {
        window.WebSocket = window.MozWebSocket
      }
      function send(message) {
        if (!window.WebSocket) {
          return
        }
        if (socket.readyState == WebSocket.OPEN) {
          socket.send(message)
        } else {
          alert("连接没有开启.")
        }
      }
      const socket = new WebSocket("ws://127.0.0.1:6086/00010002-0003-4004-8005-000600070008")
	  let time =  new Date().getTime()

      socket.onmessage = function (event) {
		  let msg = JSON.parse(event.data)
		  if(msg.method=="Runtime.consoleAPICalled"){
        let args = []
        for (let e of msg.params.args) {
          if(e.type=="object"){
            args.push(e.className)
            args.push({e})
          }else{
            args.push(e.value)
          }
       }
        args.push(msg.params.timestamp)
        vc.log.addLogRemote(msg.params.type=="warning"?"warn":msg.params.type,...args)

    }
  }
		

        socket.onopen = function (event) {
		        let msg = [
		         "{\"id\":1,\"method\":\"Runtime.enable\",\"params\":{\"returnByValue\":\"true\"}}",
		         "{\"id\":2,\"method\":\"Debugger.enable\",\"params\":{\"maxScriptsCacheSize\":10000000}}",
		         "{\"id\":3,\"method\":\"Debugger.setPauseOnExceptions\",\"params\":{\"state\":\"none\"}}",
		         "{\"id\":4,\"method\":\"Debugger.setAsyncCallStackDepth\",\"params\":{\"maxDepth\":32}}",
		         "{\"id\":5,\"method\":\"Profiler.enable\",\"params\":{}}",
	           "{\"id\":6,\"method\":\"Debugger.setBlackboxPatterns\",\"params\":{\"patterns\":[\"/node_modules/|/bower_components/\"]}}",
		         "{\"id\":7,\"method\":\"Runtime.runIfWaitingForDebugger\",\"params\":{}}"
		        ]
             for (let e of msg)
                  send(e)
            }
              socket.onclose = function (event) {
        }
       }

       let vc = new VConsole({ theme: 'dark' });
       setTimeout(() => {
        create_wesocket()
       }, 100);
       
    </script>

  </body>
</html>
